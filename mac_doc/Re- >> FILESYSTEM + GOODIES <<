Date: Mon, 05 Oct 1998 23:36:37 -0500Subject: Re: >> FILESYSTEM + GOODIES <<From: "Marin Saric" <msaric@tir.com>To: Arnaud Blanchard <jblancha@pratique.fr> Mime-version: 1.0X-Priority: 3Hi Arnaud!I hope you are not too mad at my buggy stuff! >BUG i found , in "your" stuff :>i) Before the hardfile was buggy (in fact it works, but when >you restart, it don't work anymore)>Now , it's better, it just said "not a DOS disk in device UAE0" or smth like this hmmm... Had to correct this before release... Any Idea ?Yeah. I think I screwed up. If you take a look at filesys_zajc][.c, you'll see this code in dup_mountinfo(): if (uip->hf.fd)uip->hf.fd = /*fdopen (fileno (uip->hf.fd), uip->readonly ? "rb" : "r+b");*/NULL;change it to://if (uip->hf.fd)// uip->hf.fd = fdopen (fileno (uip->hf.fd), uip->readonly ? "rb" : "r+b");because we don't need that stupid check after all, and if you set uip->hf.fd to 0 (that is what I stupidly did), he is going to screw up..BTW, it doesn't work after software restart.. but try hard-reset (command-R)instead of ctrl-pageup-pagedown...If that works, than you and I have the same problem, and that is about thatbad bug in custom reset we need to inform Bernd about.. >ii) you blitting code is slower than mine on my CPU ( 603ev ) >Strange, isn't it ?No, actually. 603xx generation is the only PPC CPU which *sometimes* takes3 cycles for lfdu.. on all other PPC's it is one cycle. so lfd+add combination is faster on 603.. Anyway, this should still be faster than atomic loads you used before... for about 10%..On all other CPU'smy code is 25-100% faster, I've tested it on a lot of PowerMacs to be sure it works nice..(I had the same problems with NIKAD, the demo my brother and I coded) Sorry, Arnaud.. 603 = bad PowerPC CPU :( (actually, it is not that bad, it's just that its FPU suxx... ) But, if you want, we could have options in boot menu in gfx menu for 603. If 603 is on, we would put your blit loops ... >iii) Now I see a lot of (black) pixel disturbing my screen !! >strange... but not in PIcasso Mode... I think my video card don't like your codeAhem... Errr... Sorry, I haven't tested the 8-bit and 32-bit versions... 16-bit seems to work nice, doesn't it? :} (hysterical smile) >iv) Before the 8bit color mode was "broken"... >now the 32bits mode, too !!>iv) The 256 color mode is 100% buggy , and I loosed ALL my files >with the new pallette stuff, to correct this !! Oooops.. Sorry! My fault. :*>v) UAE-086 released a few month ago... I think I'll >put MacUAE to 086 VERY fast... ( principally Picasso stuff corrected )>Having time, I switched to UAE-086 , and modifiy 1 thing in drawing.c (line 500), and it's disabling part of your optimization and the problem iii), iv) is solved ? Cool ! I switched to 086 : v) solved>I'm not sure about ii) now.>So , there is just the i) to solve ;-)cool, I'll take a look at filesystem...>I made a new .sit file, with the new sources... Take a lok in>-> drawing.c line 500 : it disable your code, but it works better Yeah.. try to leave my part for 16-bit color and see how it works, it should go faster... Of course.. if you want to.. pleeease :) ? >-> filesys_zajc][.c : look for ATB , i tried to update your files, to match >the new version of the filesys, but it crash... Strange... I'll try to fix that.. Your changes look OK... >ok ?Yeah, cool.. I hope I solved that hardfile mystery.. >so you can take the new sources here>http://www.pratique.fr/~jblancha/MacUAE8.6.sit.hqx WARNING !!! : There is no link to this file, on my hompeage : it's only for you ...Aaargh! It took me 4 hours to download.. The connection was super-slow.. That was unusual.. Usually it's about 2K/s... I hope I did some good, it is fun working with you, Marin(!ZAJC!/GDS)